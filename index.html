<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">

    <title>englishBoost</title>

    <!-- Required Stylesheets -->
    <link type="text/css" rel="stylesheet" href="https://unpkg.com/bootstrap@next/dist/css/bootstrap.min.css"/>
    <link type="text/css" rel="stylesheet" href="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.css"/>

    <!-- Required scripts -->
    <script src="https://unpkg.com/vue"></script>
    <script src="https://unpkg.com/babel-polyfill@latest/dist/polyfill.min.js"></script>
    <script src="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.js"></script>

    <style type="text/css">
		body {
			font-family: Calibri;
			font-size: 18px;
		}
        b-card {
            color: red;
        }
	</style>
  </head>

<!-- https://bootstrap-vue.js.org/docs/components -->
  <body>
    <div id="app">
      <b-container fluid>
        <b-row>
	        <b-col>
	        	<h1>English Boost</h1>
		    	<p>Boost English learning with customized dictionaries</p>
	        </b-col>
	    </b-row>
        <b-row>
	        <b-col>
                <b-form-group>
    	        	<b-file accept="text/*" id="file_input" v-model="textFile"></b-file>
                </b-form-group>

                <b-card v-if="newDict">
                    <b-form-group>
                        <b-input v-model="newDict.name"></b-input>
                        <b-input v-model="newDict.description" placeholder="description"></b-input>
                    </b-form-group>
                    <p class="card-text">Total words: {{ newDict.totalWordsCount }}</p>
                    <p class="card-text">Uniq words:  {{ newDict.uniqWordsCount }}</p>
                    <p class="card-text">80% words:   {{ newDict.Pareto }}</p>
                    <b-button size="sm" variant="outline-secondary" @click="addDict">Add dictionary</b-button>
                </b-card>
	        </b-col>

	        <b-col>
                <div v-for="dict in dicts" v-if="seeDicts">
                    <b-card :title="dict.name + ' (' + dict.uniqWordsCount + ')'">
                        <p class="card-text">{{dict.description}}</p>
                        <b-form-group>
                            <b-progress class="mt-1" show-value>
                                <b-progress-bar show-progress :value="60" variant="danger"></b-progress-bar>
                                <b-progress-bar show-progress :value="30" variant="warning"></b-progress-bar>
                                <b-progress-bar show-progress :value="10" variant="success"></b-progress-bar>
                            </b-progress>
                        </b-form-group>
                        <b-form-group>
                            <b-button size="sm" variant="outline-secondary" @click="explore">Explore</b-button>
                        </b-form-group>
                    </b-card>
                </div>
            </b-col>
            <b-col>
	        </b-col>
	    </b-row>
      </b-container>
    </div>

    <script>
      window.app = new Vue({
        el: "#app",
        data: {
			textFile: null, // File object
			text: null,
			newDict: null,
            dicts: [],
            learnDict: null,
            knownDict: null,
            seeDicts: true
        },
        watch: {
			textFile: function() {
				if (this.textFile) {
					var reader = new FileReader();
					reader.onload = function() {
						app.text = reader.result;
						app.newDict = app.buildDictionary(app.text, app.textFile.name);
					};
					reader.readAsText(app.textFile);
				}
			},
        },
        methods: {
            explore: function() {

            },
            addDict: function(event) {
                this.dicts.push(this.newDict);
                this.newDict = null;
            },
        	buildDictionary: function(text, name) {
        		var words = text.split(/\W+/);
				for (var i = 0; i < words.length - 1; i++) {
				    words[i] += " ";
				}
                var words = words.map(function(word){
                    return word.toLowerCase().trim();
                });
                var words = words.filter(function(word){
                    return word.length > 1;
                });

                var uniqWords = {};
                for (var i = 0; i < words.length; i++) {
                    var word = words[i];
                    if (uniqWords.hasOwnProperty(word) ) {
                        uniqWords[word]++;
                    } else {
                        uniqWords[word] = 1;
                    }
                }
                var uniqCount = Object.keys(uniqWords).length;
                var sortUniq = this.objectSort(uniqWords);
                var paretoLimit = uniqCount*0.8;
                var pareto = [];

                var acc = 0;
                for (var i = 0; i < sortUniq.length; i++) {
                    pareto.push(sortUniq[i][0]);
                    acc += sortUniq[i][1];
                    if (acc > paretoLimit) {
                        break;
                    }
                }

        		return {
                    phrases: [],
                    totalWordsCount: words.length,
                    uniqWordsCount: uniqCount,
                    Pareto: pareto,
                    uniqWords: sortUniq,
                    name: name,
                    description: '',
                };
        	},
            objectSort: function(obj) {
                var sortable = [];
                for (var property in obj) {
                    sortable.push([property, obj[property]]);
                }
                sortable.sort(function(a, b) {
                    return b[1] - a[1];
                });
                return sortable;
            }
        } 
      })
    </script>

  </body>
</html>